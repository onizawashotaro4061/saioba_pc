# お問い合わせフォーム セットアップ手順

## 完了した作業
✅ Nodemailerのインストール
✅ お問い合わせフォームの実装
✅ メール送信APIの実装
✅ バリデーション機能
✅ 自動返信メール機能

## 必要な設定（重要）

メール送信機能を有効にするには、Gmailアプリパスワードの設定が必要です。

### 1. Gmailアプリパスワードの取得方法

#### ステップ1: Googleアカウントの2段階認証を有効化
1. https://myaccount.google.com/security にアクセス
2. 「Googleへのログイン」セクションで「2段階認証プロセス」をクリック
3. 手順に従って2段階認証を有効化

#### ステップ2: アプリパスワードの生成
1. https://myaccount.google.com/apppasswords にアクセス
2. 「アプリを選択」から「メール」を選択
3. 「デバイスを選択」から「その他（名前を入力）」を選択
4. 「劇団さいおうばWebサイト」などと入力
5. 「生成」をクリック
6. 表示された16桁のパスワードをコピー（例：abcd efgh ijkl mnop）

### 2. 環境変数ファイルの設定

プロジェクトルートの `.env.local` ファイルを開いて、以下のように編集：

```env
# Gmail SMTP設定
EMAIL_USER=gekidansaiouba@gmail.com
EMAIL_PASS=生成したアプリパスワードをここに貼り付け（スペースなし）
```

**例：**
```env
EMAIL_USER=gekidansaiouba@gmail.com
EMAIL_PASS=abcdefghijklmnop
```

**注意事項：**
- アプリパスワードは16桁の英数字です
- スペースは削除してください
- このファイルは`.gitignore`に含まれているため、Gitにコミットされません

### 3. 開発サーバーの再起動

環境変数を変更した後は、開発サーバーを再起動してください：

```bash
# サーバーを停止（Ctrl + C）
# 再度起動
npm run dev
```

## 機能説明

### お問い合わせフォームの機能

1. **入力バリデーション**
   - お名前（必須）
   - メールアドレス（必須、形式チェック）
   - 電話番号（必須、形式チェック：ハイフンなし、10桁または11桁の半角数字）
   - お問い合わせタイトル（選択式、必須）
   - お問い合わせ内容（必須）

2. **メール送信**
   - 劇団へ：お問い合わせ内容の通知
   - 問い合わせ者へ：自動返信メール

3. **エラーハンドリング**
   - 入力エラーの表示
   - 送信成功/失敗のメッセージ表示

## テスト方法

1. 開発サーバーを起動：
   ```bash
   npm run dev
   ```

2. ブラウザで http://localhost:3000/contact にアクセス

3. フォームに以下のテストデータを入力：
   - お名前: テスト太郎
   - メールアドレス: 自分のメールアドレス
   - 電話番号: 09012345678（ハイフンなし）
   - お問い合わせタイトル: その他
   - お問い合わせ内容: テストメッセージです

4. 送信ボタンをクリック

5. 確認：
   - gekidansaiouba@gmail.comに問い合わせメールが届く
   - 入力したメールアドレスに自動返信メールが届く

## トラブルシューティング

### メールが送信されない場合

1. **環境変数の確認**
   ```bash
   # .env.localファイルの内容を確認
   # EMAIL_USERとEMAIL_PASSが正しく設定されているか
   ```

2. **開発サーバーの再起動**
   - 環境変数変更後は必ず再起動が必要

3. **Gmailの設定確認**
   - 2段階認証が有効か
   - アプリパスワードが正しいか
   - アカウントがロックされていないか

4. **ブラウザのコンソールを確認**
   - F12キーでデベロッパーツールを開く
   - エラーメッセージを確認

5. **ターミナルのログを確認**
   - サーバーのエラーログを確認

### よくあるエラー

**Error: Invalid login**
→ アプリパスワードが間違っている可能性があります。再生成してください。

**Error: Network error**
→ インターネット接続を確認してください。

**535-5.7.8 Username and Password not accepted**
→ 2段階認証が有効になっていない、またはアプリパスワードではなく通常のパスワードを使用している可能性があります。

## セキュリティ注意事項

- `.env.local`ファイルは絶対にGitにコミットしないでください
- アプリパスワードは他人に共有しないでください
- 本番環境では、環境変数はホスティングサービスの設定画面で設定してください（Vercel、Netlifyなど）

## 本番環境へのデプロイ

Vercelにデプロイする場合：

1. Vercelダッシュボードにログイン
2. プロジェクトの「Settings」→「Environment Variables」
3. 以下の環境変数を追加：
   - `EMAIL_USER`: gekidansaiouba@gmail.com
   - `EMAIL_PASS`: アプリパスワード
4. 再デプロイ

## サポート

問題が解決しない場合は、以下の情報を添えてお問い合わせください：
- エラーメッセージ
- ブラウザのコンソールログ
- サーバーのターミナルログ
